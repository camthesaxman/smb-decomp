.include "macros.inc"

.section .text, "ax"  # 0x800065A0 - 0x8010F860

.global TRKTestForPacket
TRKTestForPacket:
/* 8010A65C 0010657C  7C 08 02 A6 */	mflr r0
/* 8010A660 00106580  90 01 00 04 */	stw r0, 4(r1)
/* 8010A664 00106584  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8010A668 00106588  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8010A66C 0010658C  93 C1 00 10 */	stw r30, 0x10(r1)
/* 8010A670 00106590  48 00 39 09 */	bl TRKPollUART
/* 8010A674 00106594  7C 7E 1B 79 */	or. r30, r3, r3
/* 8010A678 00106598  40 81 00 88 */	ble lbl_8010A700
/* 8010A67C 0010659C  38 61 00 08 */	addi r3, r1, 8
/* 8010A680 001065A0  38 81 00 0C */	addi r4, r1, 0xc
/* 8010A684 001065A4  4B FF F8 11 */	bl TRKGetFreeBuffer
/* 8010A688 001065A8  2C 1E 08 80 */	cmpwi r30, 0x880
/* 8010A68C 001065AC  40 81 00 4C */	ble lbl_8010A6D8
/* 8010A690 001065B0  48 00 00 2C */	b lbl_8010A6BC
lbl_8010A694:
/* 8010A694 001065B4  2C 1E 08 80 */	cmpwi r30, 0x880
/* 8010A698 001065B8  40 81 00 0C */	ble lbl_8010A6A4
/* 8010A69C 001065BC  3B E0 08 80 */	li r31, 0x880
/* 8010A6A0 001065C0  48 00 00 08 */	b lbl_8010A6A8
lbl_8010A6A4:
/* 8010A6A4 001065C4  7F DF F3 78 */	mr r31, r30
lbl_8010A6A8:
/* 8010A6A8 001065C8  80 61 00 0C */	lwz r3, 0xc(r1)
/* 8010A6AC 001065CC  38 9F 00 00 */	addi r4, r31, 0
/* 8010A6B0 001065D0  38 63 00 10 */	addi r3, r3, 0x10
/* 8010A6B4 001065D4  48 00 38 F5 */	bl TRKReadUARTN
/* 8010A6B8 001065D8  7F DF F0 50 */	subf r30, r31, r30
lbl_8010A6BC:
/* 8010A6BC 001065DC  2C 1E 00 00 */	cmpwi r30, 0
/* 8010A6C0 001065E0  41 81 FF D4 */	bgt lbl_8010A694
/* 8010A6C4 001065E4  80 61 00 0C */	lwz r3, 0xc(r1)
/* 8010A6C8 001065E8  38 80 00 FF */	li r4, 0xff
/* 8010A6CC 001065EC  38 A0 00 06 */	li r5, 6
/* 8010A6D0 001065F0  48 00 02 D9 */	bl TRKStandardACK
/* 8010A6D4 001065F4  48 00 00 2C */	b lbl_8010A700
lbl_8010A6D8:
/* 8010A6D8 001065F8  80 61 00 0C */	lwz r3, 0xc(r1)
/* 8010A6DC 001065FC  38 9E 00 00 */	addi r4, r30, 0
/* 8010A6E0 00106600  38 63 00 10 */	addi r3, r3, 0x10
/* 8010A6E4 00106604  48 00 38 C5 */	bl TRKReadUARTN
/* 8010A6E8 00106608  2C 03 00 00 */	cmpwi r3, 0
/* 8010A6EC 0010660C  40 82 00 14 */	bne lbl_8010A700
/* 8010A6F0 00106610  80 61 00 0C */	lwz r3, 0xc(r1)
/* 8010A6F4 00106614  93 C3 00 08 */	stw r30, 8(r3)
/* 8010A6F8 00106618  80 61 00 08 */	lwz r3, 8(r1)
/* 8010A6FC 0010661C  48 00 00 18 */	b lbl_8010A714
lbl_8010A700:
/* 8010A700 00106620  80 61 00 08 */	lwz r3, 8(r1)
/* 8010A704 00106624  2C 03 FF FF */	cmpwi r3, -1
/* 8010A708 00106628  41 82 00 08 */	beq lbl_8010A710
/* 8010A70C 0010662C  4B FF F8 51 */	bl TRKReleaseBuffer
lbl_8010A710:
/* 8010A710 00106630  38 60 FF FF */	li r3, -1
lbl_8010A714:
/* 8010A714 00106634  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8010A718 00106638  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 8010A71C 0010663C  38 21 00 18 */	addi r1, r1, 0x18
/* 8010A720 00106640  80 01 00 04 */	lwz r0, 4(r1)
/* 8010A724 00106644  7C 08 03 A6 */	mtlr r0
/* 8010A728 00106648  4E 80 00 20 */	blr

.global TRKGetInput
TRKGetInput:
/* 8010A72C 0010664C  7C 08 02 A6 */	mflr r0
/* 8010A730 00106650  90 01 00 04 */	stw r0, 4(r1)
/* 8010A734 00106654  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8010A738 00106658  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8010A73C 0010665C  93 C1 00 10 */	stw r30, 0x10(r1)
/* 8010A740 00106660  4B FF FF 1D */	bl TRKTestForPacket
/* 8010A744 00106664  3B C3 00 00 */	addi r30, r3, 0
/* 8010A748 00106668  2C 1E FF FF */	cmpwi r30, -1
/* 8010A74C 0010666C  41 82 00 44 */	beq lbl_8010A790
/* 8010A750 00106670  7F C3 F3 78 */	mr r3, r30
/* 8010A754 00106674  4B FF F7 DD */	bl TRKGetBuffer
/* 8010A758 00106678  3B E3 00 00 */	addi r31, r3, 0
/* 8010A75C 0010667C  38 80 00 00 */	li r4, 0
/* 8010A760 00106680  4B FF F8 A5 */	bl TRKSetBufferPosition
/* 8010A764 00106684  38 7F 00 00 */	addi r3, r31, 0
/* 8010A768 00106688  38 81 00 08 */	addi r4, r1, 8
/* 8010A76C 0010668C  4B FF FC 1D */	bl TRKReadBuffer1_ui8
/* 8010A770 00106690  88 01 00 08 */	lbz r0, 8(r1)
/* 8010A774 00106694  28 00 00 80 */	cmplwi r0, 0x80
/* 8010A778 00106698  40 80 00 10 */	bge lbl_8010A788
/* 8010A77C 0010669C  7F C3 F3 78 */	mr r3, r30
/* 8010A780 001066A0  48 00 00 29 */	bl TRKProcessInput
/* 8010A784 001066A4  48 00 00 0C */	b lbl_8010A790
lbl_8010A788:
/* 8010A788 001066A8  7F C3 F3 78 */	mr r3, r30
/* 8010A78C 001066AC  4B FF F7 D1 */	bl TRKReleaseBuffer
lbl_8010A790:
/* 8010A790 001066B0  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8010A794 001066B4  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 8010A798 001066B8  38 21 00 18 */	addi r1, r1, 0x18
/* 8010A79C 001066BC  80 01 00 04 */	lwz r0, 4(r1)
/* 8010A7A0 001066C0  7C 08 03 A6 */	mtlr r0
/* 8010A7A4 001066C4  4E 80 00 20 */	blr

.global TRKProcessInput
TRKProcessInput:
/* 8010A7A8 001066C8  7C 08 02 A6 */	mflr r0
/* 8010A7AC 001066CC  38 80 00 02 */	li r4, 2
/* 8010A7B0 001066D0  90 01 00 04 */	stw r0, 4(r1)
/* 8010A7B4 001066D4  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8010A7B8 001066D8  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8010A7BC 001066DC  3B E3 00 00 */	addi r31, r3, 0
/* 8010A7C0 001066E0  38 61 00 08 */	addi r3, r1, 8
/* 8010A7C4 001066E4  4B FF F4 59 */	bl TRKConstructEvent
/* 8010A7C8 001066E8  3C 60 80 2F */	lis r3, gTRKFramingState@ha
/* 8010A7CC 001066EC  93 E1 00 10 */	stw r31, 0x10(r1)
/* 8010A7D0 001066F0  38 83 FC 20 */	addi r4, r3, gTRKFramingState@l
/* 8010A7D4 001066F4  38 61 00 08 */	addi r3, r1, 8
/* 8010A7D8 001066F8  38 00 FF FF */	li r0, -1
/* 8010A7DC 001066FC  90 04 00 00 */	stw r0, 0(r4)
/* 8010A7E0 00106700  4B FF F3 5D */	bl TRKPostEvent
/* 8010A7E4 00106704  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8010A7E8 00106708  38 21 00 18 */	addi r1, r1, 0x18
/* 8010A7EC 0010670C  80 01 00 04 */	lwz r0, 4(r1)
/* 8010A7F0 00106710  7C 08 03 A6 */	mtlr r0
/* 8010A7F4 00106714  4E 80 00 20 */	blr

.global TRKInitializeSerialHandler
TRKInitializeSerialHandler:
/* 8010A7F8 00106718  3C 60 80 2F */	lis r3, gTRKFramingState@ha
/* 8010A7FC 0010671C  38 83 FC 20 */	addi r4, r3, gTRKFramingState@l
/* 8010A800 00106720  38 00 FF FF */	li r0, -1
/* 8010A804 00106724  90 04 00 00 */	stw r0, 0(r4)
/* 8010A808 00106728  38 00 00 00 */	li r0, 0
/* 8010A80C 0010672C  38 60 00 00 */	li r3, 0
/* 8010A810 00106730  98 04 00 08 */	stb r0, 8(r4)
/* 8010A814 00106734  90 04 00 0C */	stw r0, 0xc(r4)
/* 8010A818 00106738  4E 80 00 20 */	blr

.global TRKTerminateSerialHandler
TRKTerminateSerialHandler:
/* 8010A81C 0010673C  38 60 00 00 */	li r3, 0
/* 8010A820 00106740  4E 80 00 20 */	blr

.section .bss

.global gTRKFramingState
gTRKFramingState:
	.skip 0x14
.global gTRKInputPendingPtr
gTRKInputPendingPtr:
	.skip 0x4
