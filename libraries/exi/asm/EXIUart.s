.include "macros.inc"

.section .text, "ax"  # 0x800065A0 - 0x8010F860

.global InitializeUART
InitializeUART:
/* 800C9DA0 000C5CC0  7C 08 02 A6 */	mflr r0
/* 800C9DA4 000C5CC4  90 01 00 04 */	stw r0, 4(r1)
/* 800C9DA8 000C5CC8  94 21 FF F8 */	stwu r1, -8(r1)
/* 800C9DAC 000C5CCC  4B FF 7A 01 */	bl OSGetConsoleType
/* 800C9DB0 000C5CD0  54 60 00 C7 */	rlwinm. r0, r3, 0, 3, 3
/* 800C9DB4 000C5CD4  40 82 00 14 */	bne lbl_800C9DC8
/* 800C9DB8 000C5CD8  38 00 00 00 */	li r0, 0
/* 800C9DBC 000C5CDC  90 0D A1 78 */	stw r0, serEnabled@sda21(r13)
/* 800C9DC0 000C5CE0  38 60 00 02 */	li r3, 2
/* 800C9DC4 000C5CE4  48 00 00 14 */	b lbl_800C9DD8
lbl_800C9DC8:
/* 800C9DC8 000C5CE8  3C 60 A5 FF */	lis r3, 0xA5FF005A@ha
/* 800C9DCC 000C5CEC  38 03 00 5A */	addi r0, r3, 0xA5FF005A@l
/* 800C9DD0 000C5CF0  90 0D A1 78 */	stw r0, serEnabled@sda21(r13)
/* 800C9DD4 000C5CF4  38 60 00 00 */	li r3, 0
lbl_800C9DD8:
/* 800C9DD8 000C5CF8  80 01 00 0C */	lwz r0, 0xc(r1)
/* 800C9DDC 000C5CFC  38 21 00 08 */	addi r1, r1, 8
/* 800C9DE0 000C5D00  7C 08 03 A6 */	mtlr r0
/* 800C9DE4 000C5D04  4E 80 00 20 */	blr

.global ReadUARTN
ReadUARTN:
/* 800C9DE8 000C5D08  38 60 00 04 */	li r3, 4
/* 800C9DEC 000C5D0C  4E 80 00 20 */	blr

.global WriteUARTN
WriteUARTN:
/* 800C9DF0 000C5D10  7C 08 02 A6 */	mflr r0
/* 800C9DF4 000C5D14  90 01 00 04 */	stw r0, 4(r1)
/* 800C9DF8 000C5D18  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 800C9DFC 000C5D1C  BF 41 00 18 */	stmw r26, 0x18(r1)
/* 800C9E00 000C5D20  3B 43 00 00 */	addi r26, r3, 0
/* 800C9E04 000C5D24  3B 64 00 00 */	addi r27, r4, 0
/* 800C9E08 000C5D28  80 AD A1 78 */	lwz r5, serEnabled@sda21(r13)
/* 800C9E0C 000C5D2C  3C 05 5A 01 */	addis r0, r5, 0x5a01
/* 800C9E10 000C5D30  28 00 00 5A */	cmplwi r0, 0x5a
/* 800C9E14 000C5D34  41 82 00 0C */	beq lbl_800C9E20
/* 800C9E18 000C5D38  38 60 00 02 */	li r3, 2
/* 800C9E1C 000C5D3C  48 00 01 C0 */	b lbl_800C9FDC
lbl_800C9E20:
/* 800C9E20 000C5D40  38 60 00 00 */	li r3, 0
/* 800C9E24 000C5D44  38 80 00 01 */	li r4, 1
/* 800C9E28 000C5D48  38 A0 00 00 */	li r5, 0
/* 800C9E2C 000C5D4C  4B FF B2 A1 */	bl EXILock
/* 800C9E30 000C5D50  2C 03 00 00 */	cmpwi r3, 0
/* 800C9E34 000C5D54  40 82 00 0C */	bne lbl_800C9E40
/* 800C9E38 000C5D58  38 60 00 00 */	li r3, 0
/* 800C9E3C 000C5D5C  48 00 01 A0 */	b lbl_800C9FDC
lbl_800C9E40:
/* 800C9E40 000C5D60  38 9A 00 00 */	addi r4, r26, 0
/* 800C9E44 000C5D64  38 60 00 0D */	li r3, 0xd
/* 800C9E48 000C5D68  48 00 00 18 */	b lbl_800C9E60
lbl_800C9E4C:
/* 800C9E4C 000C5D6C  88 04 00 00 */	lbz r0, 0(r4)
/* 800C9E50 000C5D70  28 00 00 0A */	cmplwi r0, 0xa
/* 800C9E54 000C5D74  40 82 00 08 */	bne lbl_800C9E5C
/* 800C9E58 000C5D78  98 64 00 00 */	stb r3, 0(r4)
lbl_800C9E5C:
/* 800C9E5C 000C5D7C  38 84 00 01 */	addi r4, r4, 1
lbl_800C9E60:
/* 800C9E60 000C5D80  7C 1A 20 50 */	subf r0, r26, r4
/* 800C9E64 000C5D84  7C 00 D8 40 */	cmplw r0, r27
/* 800C9E68 000C5D88  41 80 FF E4 */	blt lbl_800C9E4C
/* 800C9E6C 000C5D8C  3C 00 A0 01 */	lis r0, 0xa001
/* 800C9E70 000C5D90  90 01 00 14 */	stw r0, 0x14(r1)
/* 800C9E74 000C5D94  3B 80 00 00 */	li r28, 0
/* 800C9E78 000C5D98  3F E0 20 01 */	lis r31, 0x2001
/* 800C9E7C 000C5D9C  48 00 01 4C */	b lbl_800C9FC8
lbl_800C9E80:
/* 800C9E80 000C5DA0  38 60 00 00 */	li r3, 0
/* 800C9E84 000C5DA4  38 80 00 01 */	li r4, 1
/* 800C9E88 000C5DA8  38 A0 00 03 */	li r5, 3
/* 800C9E8C 000C5DAC  4B FF AB E1 */	bl EXISelect
/* 800C9E90 000C5DB0  2C 03 00 00 */	cmpwi r3, 0
/* 800C9E94 000C5DB4  40 82 00 0C */	bne lbl_800C9EA0
/* 800C9E98 000C5DB8  38 00 FF FF */	li r0, -1
/* 800C9E9C 000C5DBC  48 00 00 5C */	b lbl_800C9EF8
lbl_800C9EA0:
/* 800C9EA0 000C5DC0  93 E1 00 10 */	stw r31, 0x10(r1)
/* 800C9EA4 000C5DC4  38 81 00 10 */	addi r4, r1, 0x10
/* 800C9EA8 000C5DC8  38 60 00 00 */	li r3, 0
/* 800C9EAC 000C5DCC  38 A0 00 04 */	li r5, 4
/* 800C9EB0 000C5DD0  38 C0 00 01 */	li r6, 1
/* 800C9EB4 000C5DD4  38 E0 00 00 */	li r7, 0
/* 800C9EB8 000C5DD8  4B FF A1 99 */	bl EXIImm
/* 800C9EBC 000C5DDC  38 60 00 00 */	li r3, 0
/* 800C9EC0 000C5DE0  4B FF A5 79 */	bl EXISync
/* 800C9EC4 000C5DE4  38 81 00 10 */	addi r4, r1, 0x10
/* 800C9EC8 000C5DE8  38 60 00 00 */	li r3, 0
/* 800C9ECC 000C5DEC  38 A0 00 01 */	li r5, 1
/* 800C9ED0 000C5DF0  38 C0 00 00 */	li r6, 0
/* 800C9ED4 000C5DF4  38 E0 00 00 */	li r7, 0
/* 800C9ED8 000C5DF8  4B FF A1 79 */	bl EXIImm
/* 800C9EDC 000C5DFC  38 60 00 00 */	li r3, 0
/* 800C9EE0 000C5E00  4B FF A5 59 */	bl EXISync
/* 800C9EE4 000C5E04  38 60 00 00 */	li r3, 0
/* 800C9EE8 000C5E08  4B FF AC B1 */	bl EXIDeselect
/* 800C9EEC 000C5E0C  80 01 00 10 */	lwz r0, 0x10(r1)
/* 800C9EF0 000C5E10  54 00 46 3E */	srwi r0, r0, 0x18
/* 800C9EF4 000C5E14  20 00 00 10 */	subfic r0, r0, 0x10
lbl_800C9EF8:
/* 800C9EF8 000C5E18  2C 00 00 00 */	cmpwi r0, 0
/* 800C9EFC 000C5E1C  7C 1D 03 78 */	mr r29, r0
/* 800C9F00 000C5E20  40 80 00 0C */	bge lbl_800C9F0C
/* 800C9F04 000C5E24  3B 80 FF FF */	li r28, -1
/* 800C9F08 000C5E28  48 00 00 C8 */	b lbl_800C9FD0
lbl_800C9F0C:
/* 800C9F0C 000C5E2C  2C 00 00 0C */	cmpwi r0, 0xc
/* 800C9F10 000C5E30  40 80 00 0C */	bge lbl_800C9F1C
/* 800C9F14 000C5E34  7C 00 D8 40 */	cmplw r0, r27
/* 800C9F18 000C5E38  41 80 00 B0 */	blt lbl_800C9FC8
lbl_800C9F1C:
/* 800C9F1C 000C5E3C  38 60 00 00 */	li r3, 0
/* 800C9F20 000C5E40  38 80 00 01 */	li r4, 1
/* 800C9F24 000C5E44  38 A0 00 03 */	li r5, 3
/* 800C9F28 000C5E48  4B FF AB 45 */	bl EXISelect
/* 800C9F2C 000C5E4C  2C 03 00 00 */	cmpwi r3, 0
/* 800C9F30 000C5E50  40 82 00 0C */	bne lbl_800C9F3C
/* 800C9F34 000C5E54  3B 80 FF FF */	li r28, -1
/* 800C9F38 000C5E58  48 00 00 98 */	b lbl_800C9FD0
lbl_800C9F3C:
/* 800C9F3C 000C5E5C  38 81 00 14 */	addi r4, r1, 0x14
/* 800C9F40 000C5E60  38 60 00 00 */	li r3, 0
/* 800C9F44 000C5E64  38 A0 00 04 */	li r5, 4
/* 800C9F48 000C5E68  38 C0 00 01 */	li r6, 1
/* 800C9F4C 000C5E6C  38 E0 00 00 */	li r7, 0
/* 800C9F50 000C5E70  4B FF A1 01 */	bl EXIImm
/* 800C9F54 000C5E74  38 60 00 00 */	li r3, 0
/* 800C9F58 000C5E78  4B FF A4 E1 */	bl EXISync
/* 800C9F5C 000C5E7C  48 00 00 54 */	b lbl_800C9FB0
lbl_800C9F60:
/* 800C9F60 000C5E80  2C 1D 00 04 */	cmpwi r29, 4
/* 800C9F64 000C5E84  40 80 00 0C */	bge lbl_800C9F70
/* 800C9F68 000C5E88  7C 1D D8 40 */	cmplw r29, r27
/* 800C9F6C 000C5E8C  41 80 00 54 */	blt lbl_800C9FC0
lbl_800C9F70:
/* 800C9F70 000C5E90  28 1B 00 04 */	cmplwi r27, 4
/* 800C9F74 000C5E94  40 80 00 0C */	bge lbl_800C9F80
/* 800C9F78 000C5E98  7F 7E DB 78 */	mr r30, r27
/* 800C9F7C 000C5E9C  48 00 00 08 */	b lbl_800C9F84
lbl_800C9F80:
/* 800C9F80 000C5EA0  3B C0 00 04 */	li r30, 4
lbl_800C9F84:
/* 800C9F84 000C5EA4  38 BE 00 00 */	addi r5, r30, 0
/* 800C9F88 000C5EA8  38 9A 00 00 */	addi r4, r26, 0
/* 800C9F8C 000C5EAC  38 60 00 00 */	li r3, 0
/* 800C9F90 000C5EB0  38 C0 00 01 */	li r6, 1
/* 800C9F94 000C5EB4  38 E0 00 00 */	li r7, 0
/* 800C9F98 000C5EB8  4B FF A0 B9 */	bl EXIImm
/* 800C9F9C 000C5EBC  7F 5A F2 14 */	add r26, r26, r30
/* 800C9FA0 000C5EC0  7F 7E D8 50 */	subf r27, r30, r27
/* 800C9FA4 000C5EC4  7F BE E8 50 */	subf r29, r30, r29
/* 800C9FA8 000C5EC8  38 60 00 00 */	li r3, 0
/* 800C9FAC 000C5ECC  4B FF A4 8D */	bl EXISync
lbl_800C9FB0:
/* 800C9FB0 000C5ED0  2C 1D 00 00 */	cmpwi r29, 0
/* 800C9FB4 000C5ED4  41 82 00 0C */	beq lbl_800C9FC0
/* 800C9FB8 000C5ED8  28 1B 00 00 */	cmplwi r27, 0
/* 800C9FBC 000C5EDC  40 82 FF A4 */	bne lbl_800C9F60
lbl_800C9FC0:
/* 800C9FC0 000C5EE0  38 60 00 00 */	li r3, 0
/* 800C9FC4 000C5EE4  4B FF AB D5 */	bl EXIDeselect
lbl_800C9FC8:
/* 800C9FC8 000C5EE8  28 1B 00 00 */	cmplwi r27, 0
/* 800C9FCC 000C5EEC  40 82 FE B4 */	bne lbl_800C9E80
lbl_800C9FD0:
/* 800C9FD0 000C5EF0  38 60 00 00 */	li r3, 0
/* 800C9FD4 000C5EF4  4B FF B1 ED */	bl EXIUnlock
/* 800C9FD8 000C5EF8  7F 83 E3 78 */	mr r3, r28
lbl_800C9FDC:
/* 800C9FDC 000C5EFC  BB 41 00 18 */	lmw r26, 0x18(r1)
/* 800C9FE0 000C5F00  80 01 00 34 */	lwz r0, 0x34(r1)
/* 800C9FE4 000C5F04  38 21 00 30 */	addi r1, r1, 0x30
/* 800C9FE8 000C5F08  7C 08 03 A6 */	mtlr r0
/* 800C9FEC 000C5F0C  4E 80 00 20 */	blr

.section .sbss

.global serEnabled
serEnabled:
	.skip 0x8
